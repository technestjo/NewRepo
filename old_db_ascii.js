// ============================================================
// js/database.js - Ancient Scripts Letter Database
// Uses localStorage for persistence. No server required.
// ============================================================

const LetterDB = {
  STORAGE_KEY: 'ancient_scripts_letters',
  ADMIN_KEY: 'ancient_scripts_admin',
  SESSION_KEY: 'ancient_admin_session',
  VERSION_KEY: 'ancient_scripts_version',
  DB_VERSION: '2.5', // bump to force-reset stale localStorage

  DEFAULT_ADMIN: {
    username: btoa('MasterScribe'),
    password: btoa('P@ssw0rd_Ancient$2026')
  },

  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  // SEED DATA  ??? 8 Phoenician / Canaanite Letters
  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  SEED_DATA: [
    {
      id: 1,
      code: 'PHN-001',
      nameAr: '??????',
      nameEn: 'Aleph',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '?? / ??',
      meaning: 'Ox / Bull',
      meaningAr: '?????? / ????????',
      order: 1,
      description: 'First letter of the Phoenician alphabet, derived from the Egyptian hieroglyph of an ox head. The name means "ox" in Proto-Semitic. Rotated and abstracted to become Greek Alpha and Arabic Alef.',
      descriptionAr: '?????? ?????? ???? ???????????????? ???????????????????? ???????? ???? ???????????????????????? ?????????????? ???????? ??????????. ???????? ???????? "??????" ????????????????-??????????. ?????????? ?????????? ???????????? ???????????????? ???????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'The original hieroglyph ??? an ox head viewed from the front with curved horns.',
          descriptionAr: '?????????? ?????????????????????? ???????????? ??? ?????? ?????? ???? ???????????? ???? ???????? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g>
            <path d="M 100,38 Q 68,8 46,24 Q 34,40 52,54" fill="none" stroke="currentColor" stroke-width="4.5" stroke-linecap="round"/>
            <path d="M 100,38 Q 132,8 154,24 Q 166,40 148,54" fill="none" stroke="currentColor" stroke-width="4.5" stroke-linecap="round"/>
            <ellipse cx="58" cy="76" rx="14" ry="10" fill="none" stroke="currentColor" stroke-width="3" transform="rotate(-15,58,76)"/>
            <ellipse cx="142" cy="76" rx="14" ry="10" fill="none" stroke="currentColor" stroke-width="3" transform="rotate(15,142,76)"/>
            <ellipse cx="100" cy="98" rx="52" ry="46" fill="none" stroke="currentColor" stroke-width="4.5"/>
            <circle cx="80" cy="84" r="9" fill="none" stroke="currentColor" stroke-width="3"/>
            <circle cx="80" cy="84" r="4" fill="currentColor"/>
            <circle cx="120" cy="84" r="9" fill="none" stroke="currentColor" stroke-width="3"/>
            <circle cx="120" cy="84" r="4" fill="currentColor"/>
            <ellipse cx="100" cy="115" rx="28" ry="20" fill="none" stroke="currentColor" stroke-width="3.5"/>
            <ellipse cx="90" cy="117" rx="5" ry="4" fill="currentColor"/>
            <ellipse cx="110" cy="117" rx="5" ry="4" fill="currentColor"/>
            <path d="M 55,128 Q 100,142 145,128" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="5,4"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Canaanite workers simplified the hieroglyph into an abstract inverted triangle with horns.',
          descriptionAr: '???????? ???????????????????? ?????????? ?????? ???????? ?????????? ???????? ???? ????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g>
            <path d="M 72,52 Q 50,22 28,32" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M 128,52 Q 150,22 172,32" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M 60,58 L 100,152 L 140,58 Z" fill="none" stroke="currentColor" stroke-width="6" stroke-linejoin="round"/>
            <circle cx="80" cy="82" r="7" fill="currentColor"/>
            <circle cx="120" cy="82" r="7" fill="currentColor"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'Rotated 90?? by the Phoenicians ??? now an angular shape like a rotated "A" with a crossbar.',
          descriptionAr: '?????????? ???????????????????? 90?? ??? ???????? ?????????? ???????????? ???????? ?????? "A" ?????????????? ???? ???????? ????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(100,100)">
            <path d="M 0,-68 L -46,52 M 0,-68 L 46,52" stroke="currentColor" stroke-width="8" stroke-linecap="round" fill="none"/>
            <path d="M -32,-4 L 32,-4" stroke="currentColor" stroke-width="8" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Continued evolution towards a regularized vertical stroke with angled top.',
          descriptionAr: '???????? ?????? ???????? ???????????? ???????????? ???? ?????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Nabataean script, developed from Aramaic. The precursor to the Arabic script.',
          descriptionAr: '???????? ?????????????? ???????? ???? ????????????????. ?????? ???????? ???????? ?????? ???????? ???????????? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Final evolution: the Arabic Alef (??) with Hamza (??) ??? the very first letter of the Arabic alphabet.',
          descriptionAr: '???????????? ??????????????: ?????????? ???????????? ???? ???????????? (??) ??? ?????? ?????? ???? ???????????????? ??????????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(100,100)">
            <path d="M 10,-66 Q 8,0 5,62" stroke="currentColor" stroke-width="11" stroke-linecap="round" fill="none"/>
            <path d="M -2,-82 Q 14,-96 26,-82 Q 20,-70 10,-72" fill="none" stroke="currentColor" stroke-width="4.5" stroke-linecap="round"/>
          </g>`
        }
      ]
    },
    {
      id: 2,
      code: 'PHN-002',
      nameAr: '?????? (??????)',
      nameEn: 'Beth',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'House',
      meaningAr: '?????? / ????????',
      order: 2,
      description: 'Second letter of the Phoenician alphabet. Name means "house". The floor plan of a simple dwelling served as the original symbol, later becoming the Greek Beta and Arabic Ba.',
      descriptionAr: '?????????? ???????????? ???? ???????????????? ??????????????????. ???????? ???????? "??????". ???????? ???????? ???????? ?????? ?????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'A top-down floor plan of a simple house with an opening on one side.',
          descriptionAr: '???????? ????????-???????? ?????????? ???????? ???? ???????? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(28,30)">
            <rect x="10" y="10" width="130" height="110" fill="none" stroke="currentColor" stroke-width="5"/>
            <rect x="0" y="58" width="15" height="40" fill="#0D0B08" stroke="none"/>
            <path d="M 0,58 L 10,58 M 0,98 L 10,98" stroke="currentColor" stroke-width="5" stroke-linecap="round"/>
            <path d="M 10,60 L 140,60" stroke="currentColor" stroke-width="3" stroke-dasharray="6,4"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Simplified to an angular bracket shape retaining the house outline.',
          descriptionAr: '???????? ?????? ?????? ?????????? ?????????? ?????????? ??????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(40,25)">
            <path d="M 20,135 L 20,18 L 100,18 L 100,135" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M 20,77 L 100,77" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'The angular B-shape ??? a vertical stroke with two lobes, ancestor of Greek Beta.',
          descriptionAr: '?????????? ???????????? B ??? ???????? ???????????? ???????????? ?????? ?????????? ???????????????? ????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(38,18)">
            <path d="M 20,20 L 20,162" stroke="currentColor" stroke-width="7" stroke-linecap="round"/>
            <path d="M 20,20 L 72,20 Q 96,20 96,52 Q 96,82 20,82" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M 20,82 L 72,82 Q 100,82 100,118 Q 100,158 20,162" fill="none" stroke="currentColor" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic script, open bottom, curving down.',
          descriptionAr: '???????? ?????????????? ?????????? ???? ???????????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'More rounded letter, foreshadowing the Arabic Ba loop.',
          descriptionAr: '?????? ???????? ???????????????? ???????? ???????? ?????????? ??????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Ba (??) ??? a sweeping horizontal curve with a single dot below.',
          descriptionAr: '?????????? ?????????????? (??) ??? ???? ?????????? ???????? ???????? ???? ???????? ?????????? ??????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(18,45)">
            <path d="M 152,92 Q 132,62 102,57 Q 62,52 32,72 Q 10,87 14,104" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 14,104 Q 5,112 10,122 L 158,104" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <circle cx="86" cy="142" r="9" fill="currentColor"/>
          </g>`
        }
      ]
    },
    {
      id: 3,
      code: 'PHN-003',
      nameAr: '???????? (??????)',
      nameEn: 'Gimel',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'Camel / Throwing-stick',
      meaningAr: '?????? / ?????? ??????',
      order: 3,
      description: 'Third letter; name means "camel" or "throwing-stick". Evolved into the Greek Gamma (??) and Arabic Jim (??).',
      descriptionAr: '?????????? ?????????????? ???????? ???????? "??????" ???? "?????? ??????". ???????? ?????????? ???????????? ???????????????? ???????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'The Egyptian hieroglyph for a curved throwing-stick or boomerang.',
          descriptionAr: '???????????????????????? ?????????????? ???????? ?????? ???????????? ???? ????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(18,18)">
            <path d="M 30,155 Q 18,82 78,30 Q 118,4 152,40 Q 168,66 148,92 Q 124,62 96,66 Q 58,78 56,142 Z" fill="none" stroke="currentColor" stroke-width="5.5" stroke-linejoin="round"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Simplified to an angular corner shape suggesting a camel\'s hump.',
          descriptionAr: '???????? ?????? ?????? ?????? ???????? ???????? ?????????? ??????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(28,28)">
            <path d="M 18,155 L 18,48 L 158,142" fill="none" stroke="currentColor" stroke-width="7.5" stroke-linecap="round" stroke-linejoin="round"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'An angular L-shape on its side ??? ancestor of the Greek Gamma (??).',
          descriptionAr: '?????? ???????? ?????? ?????????? ??? ?????? ???????????? ?????????????????? (??).',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(32,18)">
            <path d="M 18,28 L 128,28 L 128,162" fill="none" stroke="currentColor" stroke-width="8.5" stroke-linecap="round" stroke-linejoin="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic Gimel, smoothed lines.',
          descriptionAr: '?????? ?????????? ?????????????? ?????????? ???????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Nabataean Gimel, evolving directly into Arabic Jim.',
          descriptionAr: '?????????? ???????????? ?????????? ???????????? ?????? ?????????? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Jim (??) ??? a circular bowl open on one side, with a dot inside.',
          descriptionAr: '?????????? ???????????? (??) ??? ???????? ?????????? ?????????? ???? ?????? ???????????????? ???? ???????? ??????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(18,28)">
            <path d="M 142,62 Q 102,40 72,50 Q 30,66 24,96 Q 20,126 62,142 Q 92,152 102,132" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 146,58 Q 164,52 162,68" fill="none" stroke="currentColor" stroke-width="8.5" stroke-linecap="round"/>
            <circle cx="90" cy="108" r="8.5" fill="currentColor"/>
          </g>`
        }
      ]
    },
    {
      id: 4,
      code: 'PHN-004',
      nameAr: '???????? (??????)',
      nameEn: 'Daleth',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'Door / Tent Flap',
      meaningAr: '?????? / ???????? ????????????',
      order: 4,
      description: 'Fourth letter ??? "door". Evolved from a triangular tent-door shape through Phoenician to Greek Delta (??) and Arabic Dal (??).',
      descriptionAr: '?????????? ???????????? ??? "??????". ???????? ???? ?????? ?????? ???????????? ?????????????? ?????? ???????? ???????????????? ???????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'A triangular tent flap common in nomadic culture ??? point at top, base at bottom.',
          descriptionAr: '???????? ???????? ?????????? ???????? ???? ?????????????? ?????????????? ??? ?????? ???? ?????????????? ?????????? ???? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(18,18)">
            <path d="M 100,18 L 170,162 L 30,162 Z" fill="none" stroke="currentColor" stroke-width="5.5"/>
            <path d="M 100,18 L 100,162" stroke="currentColor" stroke-width="3" stroke-dasharray="7,5"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'A clean bold triangle representing the door.',
          descriptionAr: '???????? ???????? ?????????? ???????? ??????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(28,18)">
            <path d="M 100,22 L 166,158 L 34,158 Z" fill="none" stroke="currentColor" stroke-width="7.5" stroke-linejoin="round"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'Angular D-shape ??? a vertical stroke with a rounded top, ancestor of Greek Delta.',
          descriptionAr: '?????? D ???????? ??? ???????? ???????????? ???? ?????? ???????????????? ?????? ???????????? ??????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(28,18)">
            <path d="M 28,22 L 28,162 L 112,162 Q 162,158 162,92 Q 162,22 112,22 Z" fill="none" stroke="currentColor" stroke-width="7.5" stroke-linejoin="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic Daleth, opened up forming an elbow shape.',
          descriptionAr: '?????????? ?????????????? ???????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Smoothed out completely into a cursive stroke.',
          descriptionAr: '?????????? ???????????? ?????? ???? ???????? ????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Dal (??) ??? a graceful rounded hook, simple and elegant.',
          descriptionAr: '?????????? ???????????? (??) ??? ???????? ???????????? ?????????? ???????? ??????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(28,38)">
            <path d="M 132,102 Q 92,60 52,80 Q 22,96 26,122 Q 30,142 62,147 Q 82,150 92,132 Q 98,118 122,118 L 148,118" fill="none" stroke="currentColor" stroke-width="10.5" stroke-linecap="round"/>
          </g>`
        }
      ]
    },
    {
      id: 5,
      code: 'PHN-005',
      nameAr: '?????? (??????)',
      nameEn: 'He',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'Window / Jubilation',
      meaningAr: '?????????? / ????????????',
      order: 5,
      description: 'Fifth letter ??? depicts a man raising arms in joy, or a window. Became Greek Epsilon (??) and Arabic Ha (??).',
      descriptionAr: '?????????? ???????????? ??? ???????? ?????????? ???????????? ???????????? ???????????? ???? ??????????. ???????? ?????????????????? ???????????????? ???????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'A human figure with arms raised jubilantly overhead.',
          descriptionAr: '?????????? ?????????????? ???????? ?????????????? ???????????? ?????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(48,8)">
            <circle cx="52" cy="30" r="20" fill="none" stroke="currentColor" stroke-width="4.5"/>
            <path d="M 52,50 L 52,132" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
            <path d="M 52,76 L 10,44 M 52,76 L 94,44" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
            <path d="M 52,132 L 26,178 M 52,132 L 78,178" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Abstracted to three horizontal lines with a vertical ??? the arms and body simplified.',
          descriptionAr: '???????? ?????? ?????????? ???????? ?????????? ???? ?????????? ??? ???????????? ???????? ???? ???????? ????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(28,28)">
            <path d="M 20,48 L 132,48 M 20,95 L 102,95 M 20,142 L 132,142" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
            <path d="M 20,48 L 20,142" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'A comb-like shape: one vertical and three horizontal strokes.',
          descriptionAr: '?????? ??????: ???????? ???????????? ?????????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(28,18)">
            <path d="M 22,28 L 22,172" stroke="currentColor" stroke-width="8" stroke-linecap="round"/>
            <path d="M 22,28 L 132,28 M 22,100 L 112,100 M 22,172 L 132,172" stroke="currentColor" stroke-width="8" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic script, losing the vertical rigidity.',
          descriptionAr: '???????? ???????????????? ?????? ?????????????? ????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Nabataean script, curled down anticipating the Arabic Ha.',
          descriptionAr: '???????? ???????????? ?????????????? ?????????????????? ?????????? ?????????? ??????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Ha (??) ??? a closed loop, like an eye or simple ring.',
          descriptionAr: '?????????? ???????????? (??) ??? ???????? ?????????? ???????? ?????????? ???? ???????? ????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(28,28)">
            <path d="M 102,92 Q 102,42 66,36 Q 28,30 24,66 Q 20,102 52,118 Q 82,130 102,108 Q 122,88 118,62" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 118,62 Q 138,28 158,52" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
          </g>`
        }
      ]
    },
    {
      id: 6,
      code: 'PHN-006',
      nameAr: '?????? (??????????)',
      nameEn: 'Waw',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'Hook / Peg',
      meaningAr: '???????? / ??????',
      order: 6,
      description: 'Sixth letter ??? "hook" or "nail". Became Greek Upsilon (??), Latin F/U/V/W/Y, and Arabic Waw (??).',
      descriptionAr: '?????????? ???????????? ??? "????????" ???? "??????????". ???????? ???????????????? ?????????????? ?????????????????? F/U/V/W ?? ?????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'A tent peg or hook: a circle on top of a vertical shaft.',
          descriptionAr: '?????? ???????? ???? ????????: ?????????? ?????? ?????? ???????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(48,8)">
            <circle cx="52" cy="42" r="26" fill="none" stroke="currentColor" stroke-width="5.5"/>
            <path d="M 52,68 L 52,172" stroke="currentColor" stroke-width="6.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Simplified to a Y-fork shape.',
          descriptionAr: '???????? ?????? ?????? ???????? Y.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(38,18)">
            <path d="M 62,18 L 62,92 M 62,92 L 18,162 M 62,92 L 106,162" stroke="currentColor" stroke-width="7.5" stroke-linecap="round" fill="none"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'Y-fork shape, ancestor of Greek Upsilon and Latin V.',
          descriptionAr: '?????? ???????? Y?? ?????? ???????????????? ?????????????? ?????????????????? V.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(32,14)">
            <path d="M 68,18 L 68,102" stroke="currentColor" stroke-width="8.5" stroke-linecap="round"/>
            <path d="M 68,102 L 18,168 M 68,102 L 118,168" stroke="currentColor" stroke-width="8.5" stroke-linecap="round" fill="none"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic script, developing a distinct curve.',
          descriptionAr: '???????? ???????????????? ?????? ?????????? ????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Curved and rounded shape leading into Arabic Waw.',
          descriptionAr: '?????? ?????????? ?????????? ???????? ?????? ?????????? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Waw (??) ??? an elegant circular loop with a descending tail.',
          descriptionAr: '?????????? ???????????? (??) ??? ???????? ???????????? ?????????? ???? ?????? ????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(18,18)">
            <path d="M 112,72 Q 112,26 76,20 Q 34,14 24,56 Q 14,92 46,112 Q 72,130 102,112 Q 132,94 126,66" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 126,66 Q 142,44 148,72 Q 150,108 132,142" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
          </g>`
        }
      ]
    },
    {
      id: 7,
      code: 'PHN-007',
      nameAr: '???????? (??????)',
      nameEn: 'Zayin',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'Weapon / Sword',
      meaningAr: '???????? / ??????',
      order: 7,
      description: 'Seventh letter ??? "weapon". Became Greek Zeta (??) and Arabic Zayn (??).',
      descriptionAr: '?????????? ???????????? ??? "????????". ???????? ???????????? ?????????????????? ???????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'A stylised sword with a blade tapering to a point, and a crossguard.',
          descriptionAr: '?????? ???????? ???????? ?????????? ?????? ???????? ?????????? ????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(38,18)">
            <path d="M 62,18 L 62,132 Q 66,152 70,158" fill="none" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
            <path d="M 62,18 L 62,132 Q 58,152 54,158" fill="none" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
            <path d="M 18,112 L 106,112" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
            <rect x="55" y="158" width="14" height="28" rx="2" fill="none" stroke="currentColor" stroke-width="4.5"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Simplified to a vertical stroke with two horizontal crossbars.',
          descriptionAr: '???????? ?????? ???????? ???????????? ???? ?????????????? ??????????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(38,18)">
            <path d="M 62,18 L 62,168" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
            <path d="M 18,62 L 106,62 M 18,112 L 106,112" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'The I-beam or H-shape of Phoenician Zayin, ancestor of Greek Zeta.',
          descriptionAr: '?????? ?????????????? I ???? H ???????????? ???????????????????? ?????? ???????????? ??????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(28,18)">
            <path d="M 18,24 L 128,24 M 73,24 L 73,162 M 18,162 L 128,162" stroke="currentColor" stroke-width="8.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic script Zayin.',
          descriptionAr: '?????? ?????????? ??????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Nabataean script Zayin.',
          descriptionAr: '?????? ?????????? ????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Zayn (??) ??? identical to Waw but with a diacritical dot above.',
          descriptionAr: '?????????? ???????????? (??) ??? ?????????? ?????????? ?????? ???? ???????? ????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(18,28)">
            <path d="M 112,72 Q 112,26 76,20 Q 34,14 24,56 Q 14,92 46,112 Q 72,130 102,112 Q 132,94 126,66" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 126,66 Q 142,44 148,72 Q 150,108 132,142" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <circle cx="76" cy="-4" r="9" fill="currentColor"/>
          </g>`
        }
      ]
    },
    {
      id: 8,
      code: 'PHN-008',
      nameAr: '?????? (??????)',
      nameEn: 'Heth',
      civilization: 'Phoenician / Canaanite',
      phoenicianSymbol: '????',
      arabicSymbol: '??',
      meaning: 'Fence / Wall',
      meaningAr: '???????? / ????????',
      order: 8,
      description: 'Eighth letter ??? "fence". Became Greek Eta (??) and Arabic Ha (??).',
      descriptionAr: '?????????? ???????????? ??? "????????". ???????? ???????????? ?????????????????? ???????????? ????????????.',
      stages: [
        {
          id: 1,
          nameEn: 'Egyptian Hieroglyphic',
          nameAr: '???????????????????????? ??????????????',
          period: '~2000 BCE',
          description: 'A fence with upright posts and horizontal rails.',
          descriptionAr: '???????? ???????????? ???????????? ???????????? ??????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(18,28)">
            <path d="M 18,38 L 18,162 M 62,38 L 62,162 M 106,38 L 106,162 M 150,38 L 150,162" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
            <path d="M 18,38 L 150,38 M 18,100 L 150,100 M 18,162 L 150,162" stroke="currentColor" stroke-width="5.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 2,
          nameEn: 'Proto-Sinaitic',
          nameAr: '?????????????????? ??????????????',
          period: '~1800 BCE',
          description: 'Reduced to two uprights and two rails ??? a simplified fence.',
          descriptionAr: '???????????? ?????? ???????????? ?????????????? ??? ???????? ????????.',
          textSymbol: '',
          imageBase64: null,
          svgContent: `<g transform="translate(28,28)">
            <path d="M 22,28 L 22,162 M 132,28 L 132,162" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
            <path d="M 22,28 L 132,28 M 22,95 L 132,95 M 22,162 L 132,162" stroke="currentColor" stroke-width="7.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 3,
          nameEn: 'Phoenician',
          nameAr: '??????????????????',
          period: '~1050 BCE',
          description: 'A classic H-shape: two verticals with a crossbar, ancestor of Greek Eta.',
          descriptionAr: '?????? H ??????????????????: ?????????????? ???? ???????????? ?????? ???????????? ??????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: `<g transform="translate(24,18)">
            <path d="M 26,24 L 26,168 M 138,24 L 138,168" stroke="currentColor" stroke-width="8.5" stroke-linecap="round"/>
            <path d="M 26,96 L 138,96" stroke="currentColor" stroke-width="8.5" stroke-linecap="round"/>
          </g>`
        },
        {
          id: 4,
          nameEn: 'Aramaic',
          nameAr: '????????????????',
          period: '~800 BCE',
          description: 'Aramaic Heth.',
          descriptionAr: '?????????? ????????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 5,
          nameEn: 'Nabataean',
          nameAr: '??????????????',
          period: '~200 BCE',
          description: 'Nabataean Heth.',
          descriptionAr: '?????????? ??????????????.',
          textSymbol: '????',
          imageBase64: null,
          svgContent: ''
        },
        {
          id: 6,
          nameEn: 'Arabic',
          nameAr: '??????????????',
          period: '~400 CE',
          description: 'Arabic Ha (??) ??? an open-bottomed shape with a distinctive upper lobe.',
          descriptionAr: '?????????? ???????????? (??) ??? ?????? ?????????? ???? ???????????? ???? ???? ???????? ????????.',
          textSymbol: '??',
          imageBase64: null,
          svgContent: `<g transform="translate(13,28)">
            <path d="M 152,72 Q 132,30 92,30 Q 50,30 34,66 Q 24,90 46,110 Q 62,124 88,116" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 88,116 Q 104,112 108,96 Q 112,80 94,72" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
            <path d="M 108,96 L 148,142" fill="none" stroke="currentColor" stroke-width="9.5" stroke-linecap="round"/>
          </g>`
        }
      ]
    }
  ],

  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  // INITIALISE
  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  init() {
    // Force-reset if version mismatch (fixes stale localStorage ordering)
    const storedVer = localStorage.getItem(this.VERSION_KEY);
    if (storedVer !== this.DB_VERSION) {
      localStorage.removeItem(this.STORAGE_KEY);
      localStorage.removeItem(this.ADMIN_KEY); // Also remove old admin credentials
      localStorage.setItem(this.VERSION_KEY, this.DB_VERSION);
    }
    if (!localStorage.getItem(this.ADMIN_KEY)) {
      localStorage.setItem(this.ADMIN_KEY, JSON.stringify(this.DEFAULT_ADMIN));
    }
    if (!localStorage.getItem(this.STORAGE_KEY)) {
      localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.SEED_DATA));
    }
  },

  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  // CRUD
  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  getAll() {
    this.init();
    return JSON.parse(localStorage.getItem(this.STORAGE_KEY)) || [];
  },
  getById(id) {
    return this.getAll().find(l => l.id === parseInt(id));
  },
  add(letter) {
    const letters = this.getAll();
    letter.id = Date.now();
    letter.code = `PHN-${String(letters.length + 1).padStart(3, '0')}`;
    letters.push(letter);
    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(letters));
    return letter;
  },
  update(id, updates) {
    const letters = this.getAll();
    const idx = letters.findIndex(l => l.id === parseInt(id));
    if (idx !== -1) {
      letters[idx] = { ...letters[idx], ...updates };
      localStorage.setItem(this.STORAGE_KEY, JSON.stringify(letters));
      return letters[idx];
    }
    return null;
  },
  delete(id) {
    const letters = this.getAll().filter(l => l.id !== parseInt(id));
    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(letters));
  },
  exportJSON() {
    const blob = new Blob([JSON.stringify(this.getAll(), null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'ancient_scripts.json'; a.click();
    URL.revokeObjectURL(url);
  },
  importJSON(jsonStr) {
    try {
      const data = JSON.parse(jsonStr);
      if (Array.isArray(data)) {
        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
        return true;
      }
    } catch (e) { return false; }
    return false;
  },

  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  // ADMIN AUTH
  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  // ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
  checkAuth(username, password) {
    this.init();
    const stored = JSON.parse(localStorage.getItem(this.ADMIN_KEY) || '{}');
    return stored.username === btoa(username) && stored.password === btoa(password);
  },
  isLoggedIn() {
    return sessionStorage.getItem(this.SESSION_KEY) === 'authenticated';
  },
  login(username, password) {
    if (this.checkAuth(username, password)) {
      sessionStorage.setItem(this.SESSION_KEY, 'authenticated');
      return true;
    }
    return false;
  },
  logout() {
    sessionStorage.removeItem(this.SESSION_KEY);
  }
};
